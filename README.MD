# Portal Sale Order PDF Preview

## âš ï¸ IMPORTANTE

Este mÃ³dulo modifica **ÃšNICAMENTE** la vista del portal del cliente. **NO modifica ninguna vista del backend de Odoo**.

## ğŸ¯ Objetivo

Mostrar el Ãºltimo PDF adjunto en lugar del PDF generado automÃ¡ticamente en la vista del portal del cliente para presupuestos/Ã³rdenes de venta.

## ğŸ”§ QuÃ© hace exactamente

### âœ… Lo que SÃ modifica:
- **Solo la vista del portal del cliente** (frontend web donde los clientes ven sus presupuestos)
- Reemplaza los botones "Descargar" e "Imprimir" para usar el Ãºltimo PDF adjunto
- Muestra vista previa del PDF adjunto en lugar del PDF generado
- AÃ±ade informaciÃ³n visual sobre el PDF disponible

### âŒ Lo que NO modifica:
- **Ninguna vista del backend de Odoo** (interfaz administrativa interna)
- **NingÃºn formulario interno** de presupuestos/Ã³rdenes de venta
- **Ninguna funcionalidad del CRM** o mÃ³dulos internos
- **NingÃºn reporte o vista de lista** del backend

## ğŸ“ Estructura del mÃ³dulo

```
portal_sale_pdf/
â”œâ”€â”€ __manifest__.py                 # ConfiguraciÃ³n del mÃ³dulo
â”œâ”€â”€ __init__.py                     # Importaciones principales
â”œâ”€â”€ README.md                       # Esta documentaciÃ³n
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ sale_order.py              # SOLO campos para portal
â”œâ”€â”€ views/
â”‚   â””â”€â”€ portal_templates.xml       # SOLO templates del portal
â”œâ”€â”€ controllers/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ portal.py                  # SOLO controladores del portal
â””â”€â”€ static/src/
    â”œâ”€â”€ css/
    â”‚   â””â”€â”€ portal_pdf.css         # SOLO estilos del portal
    â””â”€â”€ js/
        â””â”€â”€ portal_pdf.js          # SOLO JavaScript del portal
```

## ğŸš€ InstalaciÃ³n

### 1. Estructura de carpetas

```bash
# Crear la estructura
mkdir -p /path/to/odoo/addons/portal_sale_pdf/{models,views,controllers,static/src/{css,js}}

# Crear archivos __init__.py
touch /path/to/odoo/addons/portal_sale_pdf/__init__.py
touch /path/to/odoo/addons/portal_sale_pdf/models/__init__.py
touch /path/to/odoo/addons/portal_sale_pdf/controllers/__init__.py
```

### 2. Copiar archivos

Copiar cada archivo en su ubicaciÃ³n correspondiente:

- `__manifest__.py` â†’ raÃ­z del mÃ³dulo
- `models/sale_order.py` â†’ carpeta models/
- `views/portal_templates.xml` â†’ carpeta views/
- `controllers/portal.py` â†’ carpeta controllers/
- `static/src/css/portal_pdf.css` â†’ carpeta static/src/css/
- `static/src/js/portal_pdf.js` â†’ carpeta static/src/js/

### 3. Instalar

1. Reiniciar Odoo
2. Actualizar lista de aplicaciones
3. Buscar "Portal Sale Order PDF Preview"
4. Instalar

## ğŸ“± CÃ³mo funciona

### Para el cliente en el portal:

1. **Accede al portal** con su usuario
2. **Ve sus presupuestos** en "Mis Pedidos"
3. **Abre un presupuesto** que tenga PDFs adjuntos
4. **Ve automÃ¡ticamente**:
   - InformaciÃ³n del PDF adjunto disponible
   - Vista previa del PDF en lugar de la cotizaciÃ³n estÃ¡ndar
   - Botones para descargar/imprimir el PDF adjunto

### Comportamiento inteligente:

- âœ… **Si HAY PDF adjunto**: Muestra y usa el PDF adjunto
- âš ï¸ **Si NO hay PDF adjunto**: Usa el comportamiento original (PDF generado)

## ğŸ¨ PersonalizaciÃ³n

### Modificar estilos

Edita `static/src/css/portal_pdf.css`:

```css
/* Cambiar colores */
.portal-pdf-info {
    border-left-color: #tu-color;
}

/* Cambiar altura del PDF */
.portal-pdf-iframe {
    height: 700px; /* tu altura preferida */
}
```

### Modificar textos

Edita `views/portal_templates.xml`:

```xml
<!-- Cambiar el mensaje informativo -->
<h6 class="mb-1">ğŸ“„ Tu mensaje personalizado</h6>
```

### AÃ±adir funcionalidad JavaScript

Edita `static/src/js/portal_pdf.js` para agregar nuevas caracterÃ­sticas.

## ğŸ”’ Seguridad

- Respeta todos los permisos existentes de Odoo
- Solo muestra PDFs que el usuario tiene derecho a ver
- No expone informaciÃ³n adicional del backend
- Mantiene los mismos controles de acceso del portal

## ğŸ§ª Testing

### Probar el mÃ³dulo:

1. **Crear un presupuesto** con PDF adjunto en el backend
2. **Compartir el presupuesto** con un cliente (portal)
3. **Acceder como cliente** al portal
4. **Verificar** que se muestra el PDF adjunto en lugar del generado

### Casos de prueba:

- âœ… Presupuesto CON PDF adjunto â†’ Muestra PDF adjunto
- âœ… Presupuesto SIN PDF adjunto â†’ Muestra cotizaciÃ³n normal
- âœ… MÃºltiples PDFs adjuntos â†’ Muestra el mÃ¡s reciente
- âœ… Botones de descarga/impresiÃ³n â†’ Usan el PDF correcto

## ğŸš« Limitaciones

- Solo afecta al portal del cliente (frontend)
- Requiere que los PDFs estÃ©n adjuntos al presupuesto
- Solo muestra el Ãºltimo PDF adjunto (por fecha de creaciÃ³n)
- No modifica la funcionalidad del backend

## ğŸ”§ Troubleshooting

### PDF no se muestra
1. Verificar que el archivo adjunto sea realmente un PDF
2. Comprobar permisos de acceso al archivo
3. Revisar que el mimetype sea 'application/pdf'

### Botones no funcionan
1. Limpiar cachÃ© del navegador
2. Verificar que los assets se carguen correctamente
3. Revisar consola del navegador para errores JavaScript

### MÃ³dulo no aparece
1. Verificar estructura de archivos
2. Comprobar que todos los `__init__.py` existen
3. Revisar logs de Odoo para errores de sintaxis

## ğŸ“ Soporte

Este mÃ³dulo estÃ¡ diseÃ±ado para ser:
- **Seguro**: No modifica funcionalidad crÃ­tica
- **Independiente**: No interfiere con otros mÃ³dulos
- **Reversible**: Se puede desinstalar sin afectar datos

---

**Â¡Perfecto para mostrar PDFs personalizados a tus clientes sin tocar el backend!** ğŸ‰