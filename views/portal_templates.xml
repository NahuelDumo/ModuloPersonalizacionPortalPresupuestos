<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <!-- Odoo 16: Extend the Sale portal order page to show the last attached PDF in the main content area. -->
    <template id="portal_my_order_pdf_preview" inherit_id="sale.sale_order_portal_template" name="Portal Order - PDF Preview" primary="True">
        <!-- Target the main content area -->
        <xpath expr="//div[contains(@class, 'o_portal_sale_content') or contains(@class, 'o_portal_order_content') or contains(@class, 'o_portal_my_doc') or @id='wrap']" position="attributes">
            <attribute name="t-if">not has_quote_pdf</attribute>
        </xpath>

        <!-- Insert PDF viewer after the main content area -->
        <xpath expr="//div[contains(@class, 'o_portal_sale_content') or contains(@class, 'o_portal_order_content') or contains(@class, 'o_portal_my_doc') or @id='wrap']" position="after">
            <div t-if="has_quote_pdf" class="o_portal_sale_pdf_viewer my-3">
                <div class="alert alert-info">
                    <i class="fa fa-info-circle me-2"></i>
                    <strong>Vista previa del presupuesto</strong>
                </div>
                <div class="d-flex justify-content-end gap-2 mb-2">
                    <a class="btn btn-secondary" t-att-href="quote_pdf_download_url">
                        <i class="fa fa-download me-1"/> Descargar
                    </a>
                    <button type="button" class="btn btn-secondary" t-att-data-url="quote_pdf_inline_url" onclick="salePortalQuoteOpenAndPrint(this.getAttribute('data-url'))">
                        <i class="fa fa-print me-1"/> Imprimir
                    </button>
                </div>
                <div class="mt-3" style="min-height: 600px; width: 100%;">
                    <div class="h-100 w-100" style="border: 1px solid #dee2e6; border-radius: 0.25rem; overflow: hidden;">
                        <iframe 
                            t-att-src="quote_pdf_inline_url"
                            width="100%" 
                            height="100%"
                            style="min-height: 600px; border: none;"
                            frameborder="0">
                            <p>Tu navegador no puede mostrar el PDF. <a t-att-href="quote_pdf_inline_url" target="_blank">Abrir PDF en nueva pesta√±a</a>.</p>
                        </iframe>
                    </div>
                </div>
            </div>
        </xpath>
    </template>
</odoo>
