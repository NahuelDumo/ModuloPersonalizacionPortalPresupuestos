<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <!-- Odoo 16: Extend the Sale portal order page to show the last attached PDF in the main content area. -->
    <template id="portal_my_order_pdf_preview" inherit_id="sale.sale_order_portal_template" name="Portal Order - PDF Preview">
        <!-- Hide original content when we have a PDF -->
        <xpath expr="//div[contains(concat(' ', normalize-space(@class), ' '), ' o_portal_sale_content ')]" position="attributes">
            <attribute name="t-if">not has_quote_pdf</attribute>
        </xpath>

        <!-- Insert PDF viewer after the original container -->
        <xpath expr="//div[contains(concat(' ', normalize-space(@class), ' '), ' o_portal_sale_content ')]" position="after">
            <div t-if="has_quote_pdf" class="o_portal_sale_pdf_viewer my-3">
                <div class="d-flex justify-content-end gap-2 mb-2">
                    <a class="btn btn-secondary" t-att-href="quote_pdf_download_url">
                        <i class="fa fa-download me-1"/> Descargar
                    </a>
                    <button type="button" class="btn btn-secondary" t-att-data-url="quote_pdf_inline_url" onclick="salePortalQuoteOpenAndPrint(this.getAttribute('data-url'))">
                        <i class="fa fa-print me-1"/> Imprimir
                    </button>
                </div>
                <div class="ratio ratio-1x1" style="--bs-aspect-ratio: 141%;">
                    <!-- Use object for better PDF plugin compatibility; fallback link shown if not supported -->
                    <object t-att-data="quote_pdf_inline_url" type="application/pdf" width="100%" height="100%">
                        <iframe t-att-src="quote_pdf_inline_url" width="100%" height="100%"></iframe>
                        <p class="mt-2">
                            Tu navegador no puede mostrar el PDF. 
                            <a t-att-href="quote_pdf_inline_url" target="_blank">Abrir PDF</a>
                        </p>
                    </object>
                </div>
            </div>
        </xpath>
    </template>
</odoo>
