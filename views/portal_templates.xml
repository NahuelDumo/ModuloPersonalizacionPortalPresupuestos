<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <!-- Odoo 16: Extend the Sale portal order page to show the last attached PDF in the main content area. -->
    <template id="portal_my_order_pdf_preview" inherit_id="sale.sale_order_portal_template" name="Portal Order - PDF Preview">
        <!-- Hide original content when we have a PDF -->
        <xpath expr="//div[@id='quote_content']" position="attributes">
            <attribute name="t-if">not has_quote_pdf</attribute>
        </xpath>

        <!-- Insert PDF viewer after the original container -->
        <xpath expr="//div[@id='quote_content']" position="after">
            <div t-if="has_quote_pdf" class="o_portal_sale_pdf_viewer my-3">
                <div class="d-flex justify-content-end gap-2 mb-2">
                    <a class="btn btn-secondary" t-att-href="quote_pdf_download_url">
                        <i class="fa fa-download me-1"/> Descargar
                    </a>
                    <button type="button" class="btn btn-secondary" t-att-data-url="quote_pdf_inline_url" onclick="salePortalQuoteOpenAndPrint(this.getAttribute('data-url'))">
                        <i class="fa fa-print me-1"/> Imprimir
                    </button>
                </div>
                <div class="mt-3" style="height: 800px; width: 100%;">
                    <!-- Direct PDF display with fallback -->
                    <div class="h-100 w-100" style="border: 1px solid #dee2e6; border-radius: 0.25rem; overflow: hidden;">
                        <iframe 
                            t-att-src="quote_pdf_inline_url"
                            width="100%" 
                            height="100%"
                            style="border: none;"
                            frameborder="0">
                            <p>Tu navegador no puede mostrar el PDF. <a t-att-href="quote_pdf_inline_url">Descargar PDF</a>.</p>
                        </iframe>
                    </div>
                    <div class="mt-2 text-center">
                        <a t-att-href="quote_pdf_download_url" class="btn btn-sm btn-link">
                            <i class="fa fa-download me-1"/> Descargar PDF
                        </a>
                    </div>
                </div>
            </div>
        </xpath>
    </template>
</odoo>
